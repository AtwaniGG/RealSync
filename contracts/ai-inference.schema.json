{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "RealSync AI Inference Service API Contract",
  "description": "Frozen v1 contract for Backend â†’ AI Service HTTP calls.",
  "definitions": {
    "analyzeFrameRequest": {
      "type": "object",
      "required": ["sessionId", "frameB64"],
      "properties": {
        "sessionId": { "type": "string", "format": "uuid" },
        "frameB64": { "type": "string", "description": "Base64-encoded JPEG frame" },
        "capturedAt": { "type": "string", "format": "date-time" }
      }
    },
    "faceResult": {
      "type": "object",
      "required": ["faceId", "bbox", "confidence", "emotion", "identity", "deepfake"],
      "properties": {
        "faceId": { "type": "integer" },
        "bbox": {
          "type": "object",
          "properties": {
            "x": { "type": "integer" },
            "y": { "type": "integer" },
            "w": { "type": "integer" },
            "h": { "type": "integer" }
          }
        },
        "confidence": { "type": "number", "minimum": 0, "maximum": 1 },
        "emotion": {
          "type": "object",
          "properties": {
            "label": { "type": "string", "enum": ["Happy", "Neutral", "Angry", "Fear", "Surprise", "Sad"] },
            "confidence": { "type": "number" },
            "scores": {
              "type": "object",
              "properties": {
                "Happy": { "type": "number" },
                "Neutral": { "type": "number" },
                "Angry": { "type": "number" },
                "Fear": { "type": "number" },
                "Surprise": { "type": "number" },
                "Sad": { "type": "number" }
              }
            }
          }
        },
        "identity": {
          "type": "object",
          "properties": {
            "embeddingShift": { "type": "number" },
            "samePerson": { "type": "boolean" },
            "riskLevel": { "type": "string", "enum": ["low", "medium", "high"] }
          }
        },
        "deepfake": {
          "type": "object",
          "properties": {
            "authenticityScore": { "type": "number" },
            "riskLevel": { "type": "string", "enum": ["low", "medium", "high"] },
            "model": { "type": "string" }
          }
        }
      }
    },
    "analyzeFrameResponse": {
      "type": "object",
      "required": ["sessionId", "processedAt", "faces", "aggregated"],
      "properties": {
        "sessionId": { "type": "string" },
        "capturedAt": { "type": "string", "format": "date-time" },
        "processedAt": { "type": "string", "format": "date-time" },
        "faces": {
          "type": "array",
          "items": { "$ref": "#/definitions/faceResult" }
        },
        "aggregated": {
          "type": "object",
          "required": ["emotion", "identity", "deepfake", "trustScore", "confidenceLayers"],
          "properties": {
            "emotion": {
              "type": "object",
              "properties": {
                "label": { "type": "string" },
                "confidence": { "type": "number" },
                "scores": { "type": "object" }
              }
            },
            "identity": {
              "type": "object",
              "properties": {
                "samePerson": { "type": "boolean" },
                "embeddingShift": { "type": "number" },
                "riskLevel": { "type": "string" }
              }
            },
            "deepfake": {
              "type": "object",
              "properties": {
                "authenticityScore": { "type": "number" },
                "riskLevel": { "type": "string" },
                "model": { "type": "string" }
              }
            },
            "trustScore": { "type": "number", "minimum": 0, "maximum": 1 },
            "confidenceLayers": {
              "type": "object",
              "properties": {
                "audio": { "type": "number" },
                "video": { "type": "number" },
                "behavior": { "type": "number" }
              }
            }
          }
        }
      }
    }
  }
}
